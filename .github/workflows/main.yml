name: Space-Efficient Verification
on: workflow_dispatch

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Maximize Runner Space
        # This removes pre-installed software (Android/Dotnet) to free up ~20GB
        run: |
          sudo rm -rf /usr/share/dotnet
          sudo rm -rf /usr/local/lib/android
          sudo rm -rf /opt/ghc

      - name: Stream Download and Hash
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # We download the zip but DO NOT unzip it yet
          gh run download 20620689602 -R Kishan200308/macos-iso-builder --name "macOS_Sonoma_14.8.3.dmg.img"
          
          # Verify the zip hash (Matches your Screenshot 2)
          echo "Verifying Zip Hash..."
          sha256sum macOS_Sonoma_14.8.3.dmg.img.zip
          
          # Extract and Hash the internal file in one go without keeping the zip
          unzip -p macOS_Sonoma_14.8.3.dmg.img.zip | sha256sum
          
          # Delete zip immediately to save space
          rm macOS_Sonoma_14.8.3.dmg.img.zip
