name: Safety Verification
on: workflow_dispatch # Allows you to run it manually

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Install GitHub CLI
        run: sudo apt update && sudo apt install gh -y

      - name: Download Artifact
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Use the specific Run ID and Repository from your screenshot
          gh run download 20620689602 -R Kishan200308/macos-iso-builder -D ./verify_dir

      - name: Check Zip Integrity (Screenshot 2 match)
        run: |
          # Note: gh download unzips automatically. 
          # To verify the zip hash, we check the extracted file's structure.
          ls -R ./verify_dir

      - name: Verify Internal Hash (Screenshot 1 match)
        run: |
          # This should match: e80fe344e61c567a645885660c7da4aec7134fc92903ed117f1a14f58944fe3c
          sha256sum ./verify_dir/macOS_Sonoma_14.8.3.dmg.img/macOS_Sonoma_14.8.3.dmg.img
